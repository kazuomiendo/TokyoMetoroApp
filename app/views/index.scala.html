@(titele: String)(implicit flash: play.api.mvc.Flash)

@main(titele)(flash) {

  <SELECT id="RailWay" name="RailWay"></SELECT>
  <SELECT id="Station" name="Station"></SELECT>
  <div id="StationTimetable"></div>
<!--   <div id="map-canvas"></div> -->

  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
  <script>
  // --------------------------------------------------------------------------------------------------------
  // --- GoogleMapを作成
  // --------------------------------------------------------------------------------------------------------
  // var map;
  // var mapOptions;
  // 
  // // 初期化
  // google.maps.event.addDomListener(window, 'load', initialize);
  // 
  // /** GoogleMap 初期化処理 */
  // function initialize() {
  //   mapOptions = {
  //     zoom: 15,
  //     scrollwheel: false,
  //     center: new google.maps.LatLng(35.68159738288667,139.76475656032562)
  //   };
  //   map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
  //   // GoogleMap クリック時の処理追加
  //   googleMapClick();
  //   // GoogleMap マウス移動時の処理追加
  //   googleMapMouseMove();
  //   // GoogleMap マウスアウト時の処理追加
  //   googleMapMouseOut();
  //   // // GoogleMap 地図移動時の処理追加
  //   // googleMapDragend();
  // }
  // 
  // /** GoogleMap クリック時の処理 */
  // function googleMapClick() {
  //   google.maps.event.addDomListener(map, 'click', function(event){
  //     console.log(event.latLng.k + '|' + event.latLng.B);
  //     mapOptions = {
  //       scrollwheel: !mapOptions.scrollwheel
  //     };
  //     map.setOptions(mapOptions);
  //   });
  // }
  // 
  // /** GoogleMap マウス移動時の処理 */
  // function googleMapMouseMove() {
  //   google.maps.event.addDomListener(map, 'mousemove', function(event){
  //     //console.log(event.latLng.k + '|' + event.latLng.B);
  //   });
  // 
  // }
  // 
  // /** GoogleMap マウスアウト時の処理   */
  // function googleMapMouseOut() {
  //   google.maps.event.addDomListener(map, 'mouseout', function(event){
  //     mapOptions = {
  //       scrollwheel: false
  //     };
  //     map.setOptions(mapOptions);
  //   });
  // }
  // 
  // /** GoogleMap 地図移動時の処理 */
  // function googleMapDragend() {
  //   google.maps.event.addDomListener(map, 'dragend', function(event){
  //     jsRoutes.controllers.AjaxController.ajaxTokyoMetoroAPIExecute2("odpt:Train").ajax({
  //       beforeSend: function() {},
  //       complete: function() {},
  //       success: function(result) {
  //         console.log(JSON.parse(result));
  //       },
  //       error: function(result) {
  //         window.alert("エラーが発生しました。画面を更新して頂くか、時間をおいてから再度お試し下さい。");
  //         $("#map-canvas").append("<p>エラーが発生しました。画面を更新して頂くか、時間をおいてから再度お試し下さい。</p>");
  //         console.log("error : " + result)
  //       }
  //     });
  //   });
  // }
  
  // --------------------------------------------------------------------------------------------------------
  // --- TokyoMetoroAPI処理を作成
  // --------------------------------------------------------------------------------------------------------
  // 初期化
  init();

  /** 初期化処理 */
  function init() {
    $("#Station").children().remove();
    $("#RailWay").children().remove();
    // 路線一覧を取得し、選択リストを作成する
    getRailway();
  }
  
  /** 路線変更時の処理 */
  $("#RailWay").change(function(){
    if (this.value) {
      // 駅情報取得
      getStation(this.value);
    } else {
      init();
    }
  });
  
  /** 駅変更時の処理 */
  $("#Station").change(function(){
    if (this.value) {
      // 駅情報取得
      getStationFacility(this.value);
    } else {
      init();
    }
  });
  
  /** 路線一覧を取得する */
  function getRailway() {
    jsRoutes.controllers.AjaxController.getRailway("odpt:Railway").ajax({
      beforeSend: function() {
        $("#RailWay").children().remove();
        $("#RailWay").append($('<option>').html("--- 選択してください ---").val(""));
      },
      complete: function() {},
      success: function(result) {
        var resultList = JSON.parse(result);
        for (i in resultList) {
          if (resultList[i].owl_sameAs == "odpt.Railway_TokyoMetro.MarunouchiBranch") {
            $("#RailWay").append($('<option>').html(resultList[i].dc_title + "線（分岐線）").val(resultList[i].owl_sameAs));
          } else {
            $("#RailWay").append($('<option>').html(resultList[i].dc_title + "線").val(resultList[i].owl_sameAs));
          }
        }
      },
      error: function(result) {
        window.alert("エラーが発生しました。画面を更新して頂くか、時間をおいてから再度お試し下さい。");
        $("#map-canvas").append("<p>エラーが発生しました。画面を更新して頂くか、時間をおいてから再度お試し下さい。</p>");
        console.log("error : " + result)
      }
    });
  }
  
  /** 駅情報取得 */
  function getStation(railWay) {
    jsRoutes.controllers.AjaxController.getStation(railWay).ajax({
      beforeSend: function() {
        $("#Station").children().remove();
        $("#Station").append($('<option>').html("--- 選択してください ---").val(""));
      },
      complete: function() {},
      success: function(result) {
        var resultList = JSON.parse(result);
        // 駅コードでソート
        resultList.sort(sort_by('odpt_stationCode', false, function(a){ 
          return a.toUpperCase();
        }));
        for (i in resultList) {
          // valueは『odpt:facility』（駅施設を表すオブジェクトのURI）を指定
          $("#Station").append($('<option>').html(resultList[i].dc_title + "駅").val(resultList[i].odpt_facility));
        }
      },
      error: function(result) {
        window.alert("エラーが発生しました。画面を更新して頂くか、時間をおいてから再度お試し下さい。");
        $("#map-canvas").append("<p>エラーが発生しました。画面を更新して頂くか、時間をおいてから再度お試し下さい。</p>");
        console.log("error : " + result)
      }
    });
  }
  
  /** 駅施設情報 odpt:StationFacility */
  function getStationFacility(station) {
    jsRoutes.controllers.AjaxController.getStationFacility(station).ajax({
      beforeSend: function() {},
      complete: function() {},
      success: function(result) {
        var resultList = JSON.parse(result);
        var obj = {};
        for (i in resultList) {
          if (station == resultList[i].owl_sameAs) {
            console.log("------------------------------------------------------------");
            console.log("--- " + resultList[i].owl_sameAs);
            console.log("------------------------------------------------------------");
            for (j in resultList[i].odpt_platformInformation) {
              if (resultList[i].odpt_platformInformation[j].odpt_barrierfreeFacility) {
                console.log(resultList[i].odpt_platformInformation[j]);
                for (k in resultList[i].odpt_platformInformation[j].odpt_barrierfreeFacility) {
                  obj[resultList[i].odpt_platformInformation[j].odpt_barrierfreeFacility[k]] = resultList[i].odpt_platformInformation[j].odpt_carNumber
                }
              }
            }
            console.log(obj);
            console.log("------------------------------------------------------------");
            for (j in resultList[i].odpt_barrierfreeFacility) {
              // console.log(resultList[i].odpt_barrierfreeFacility[j]);
              console.log(resultList[i].odpt_barrierfreeFacility[j].owl_sameAs
                + " | " + resultList[i].odpt_barrierfreeFacility[j].odpt_locatedAreaName
                + " | " + resultList[i].odpt_barrierfreeFacility[j].odpt_placeName
                + " | " + resultList[i].odpt_barrierfreeFacility[j].ugsrv_categoryName
                + " | " + resultList[i].odpt_barrierfreeFacility[j].ugsrv_remark
              );
            }
          }
        }
      },
      error: function(result) {
        window.alert("エラーが発生しました。画面を更新して頂くか、時間をおいてから再度お試し下さい。");
        $("#map-canvas").append("<p>エラーが発生しました。画面を更新して頂くか、時間をおいてから再度お試し下さい。</p>");
        console.log("error : " + result)
      }
    });
  }
  
  // /** 駅時刻表取得 */
  // function getStationTimetable(station) {
  //   jsRoutes.controllers.AjaxController.getStationTimetable(station).ajax({
  //     beforeSend: function() {},
  //     complete: function() {},
  //     success: function(result) {
  //       var resultList = JSON.parse(result);
  //       for (i in resultList) {
  //       }
  //     },
  //     error: function(result) {
  //       window.alert("エラーが発生しました。画面を更新して頂くか、時間をおいてから再度お試し下さい。");
  //       $("#map-canvas").append("<p>エラーが発生しました。画面を更新して頂くか、時間をおいてから再度お試し下さい。</p>");
  //       console.log("error : " + result)
  //     }
  //   });
  // }
  
  // --------------------------------------------------------------------------------------------------------
  // --- Util
  // --------------------------------------------------------------------------------------------------------
  // ソート関数
  var sort_by = function(prop_name, reverse, primer){
    reverse = (reverse) ? -1 : 1;
    return function(a,b){
      a = a[prop_name];
      b = b[prop_name];
      if (typeof(primer) != 'undefined'){
        a = primer(a);
        b = primer(b);
      }
      if (a < b) return reverse * -1;
      if (a > b) return reverse * 1;
      return 0;
    }
  }
  </script>
}
